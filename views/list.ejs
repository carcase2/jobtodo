<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>COAD</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  </head>
  <body>
    <%- include('nav.html') %> 
    <div class="container input-group mb-2">
        <div>
            <h3>조회 화면입니다. </h3>
            <input class="form-control m-2" id="search-input">
            
            <label for="" >진행사항</label>
            <select id="job_state" name="job_state">
                <option value="전체" selected="selected">전체</option>
                <option value="진행중">진행중</option>
                <option value="완료">완료</option>
                <option value="미진행" >미진행</option>
                <option value="보류">보류</option>
            </select>
            <button class="input-group-append btn btn-danger m-2" id="search">검색</button>
        </div>
    </div>
    <div class="container">
        <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">제목</th>
                <th scope="col">세부내용</th>
                <th scope="col">요청날짜</th>
                <th scope="col">마감예정날짜</th>
                <th scope="col">소요시간</th>
                <th scope="col">완료일</th>
                <th scope="col">요청자</th>
                <th scope="col">진행상태</th>
                <th scope="col">난이도</th>
                <th scope="col">비고</th>
              </tr>
            </thead>
            <tbody>
              <% for (var i = 0;i < posts.length;i++){ %> 
              <tr>
                <th scope="row"><%= posts[i]._id %></th>
                <td><%= posts[i].제목 %></td>
                <td><%= posts[i].세부내용 %></td>
                <td><%= posts[i].요청날짜 %></td>
                <td><%= posts[i].마감예정일 %></td>
                <td><%= posts[i].소요시간 %></td>
                <td><%= posts[i].완료일 %></td>
                <td><%= posts[i].요청자 %></td>
                <td><%= posts[i].진행상태 %></td>
                <td><%= posts[i].난이도 %></td>
                <td><%= posts[i].비고 %></td>
              </tr>
              <% } %>
            </tbody>
          </table>
       <ul class="list-group">
            <% for (var i = 0;i < posts.length;i++){ %> 
                <li class="list-group-item mb-2 mt-2" >
                    <p>글번호: <%= posts[i]._id %> </p>
                    <p>제목: <%= posts[i].제목 %> </p> 
                    <p>세부내용: <%= posts[i].세부내용 %> </p>                    
                    <p>요청날짜: <%= posts[i].요청날짜 %> </p>
                    <p>마감예정날짜: <%= posts[i].마감예정일 %> </p>
                    <p>소요시간: <%= posts[i].소요시간 %> </p> 
                    <p>완료일: <%= posts[i].완료일 %> </p> 
                    <p>요청자: <%= posts[i].요청자 %> </p> 
                    <p>진행상태: <%= posts[i].진행상태 %> </p> 
                    <p>난이도: <%= posts[i].난이도 %> </p>
                    <p>비고: <%= posts[i].비고 %> </p>    
                    <form action="/edit/<%= posts[i]._id %>" method="GET">
                        <button value = "<%= posts[i]._id %> " class="input-group-append btn btn-danger" id="edit">수정</button>
                    </form>    
                    <button class="delete" data-id="<%= posts[i]._id %>">삭제</button>        
                </li>
                <!-- <a href="/edit/<%= posts[i]._id %>">수정</a> -->
                
            <% } %>

       </ul> 
    </div>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script>
          $('.delete').click(function(e){
          $.ajax({
            method : 'DELETE',
            url : '/delete',
            data : { _id : e.target.dataset.id }
          }).done(function(결과){
            console.log('.delete')
            // $(this).parent('li').fadeOut();
            window.location.reload();
            //AJAX 성공시 실행할 코드는 여기
          })
        });
        $('#search').click(function(){
            var input_value = $('#search-input').val();
            var state_value = $('#job_state').val()
            console.log(input_value);
            if(input_value === '')
            {
                window.location.replace('/list');    
            }
            else
            {                
                window.location.replace('/search?value=' + input_value + '&' + 'state=' + state_value);
            }
        })
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
   
  </body>
</html>
